<app-header></app-header>

<div class="d-flex">

  <!-- Sidebar bÃªn trÃ¡i -->
  <app-side-bar></app-side-bar>

  <!-- PHáº¦N CHÃNH BÃŠN PHáº¢I -->
  <div class="flex-grow-1 w-100">

    <!-- PHáº¦N TAG -->
    <div class="tags-wrapper text-white px-4 pt-4">
      <h3 style="font-size: 20px;margin-bottom: 20px;">Discover tagged vocabulary collections!</h3>

      <!-- Danh sÃ¡ch tag -->
      <div class="tag-list d-flex flex-wrap justify-content-center gap-2">
        <div class="tag-badge"
             *ngFor="let tag of visibleTags; let i = index"
             [ngStyle]="{ 'background-color': getTagColor(i, activeTagIndices[i]) }"
             (click)="toggleTag(i)"
             [class.active]="activeTagIndices[i]">
          <span class="tag-icon">ðŸš€</span>
          {{ tag.tag_name }}
        </div>
      </div>

      <!-- NÃºt má»Ÿ rá»™ng/thu gá»n -->
      <div class="text-center mt-2">
        <button class="btn btn-outline-light btn-sm px-4 py-1" (click)="toggleShowAllTags()">
          {{ showAllTags ? 'Hide' : 'Show all tags' }}
        </button>
      </div>
    </div>

    <!-- Ná»˜I DUNG CHÃNH -->
    <div class="main-content flex-grow-1 d-flex flex-column">

      <!-- Pháº§n danh sÃ¡ch bá»™ tá»« -->
      <div class="flex-grow-1 p-4" style="background-color: #0C1033;">

        <!-- TiÃªu Ä‘á» -->
        <div class="section-title-with-button">
          <span>Word sets tagged with your selected topics!</span>
        </div>

        <!-- Grid cÃ¡c bá»™ tá»« -->
        <div class="vocab-grid scroll-x" #vocabContainer>
          <div class="vocab-card" *ngFor="let set of visibleVocabSets; let i = index">

            <!-- áº¢nh bá»™ tá»« -->
            <div class="card-image"></div>

            <!-- Ná»™i dung chÃ­nh -->
            <div class="card-main">
              <div class="avatar-container">
                <div class="avatar"
                     [style.background-image]="'url(assets/useric.png)'"
                     [routerLink]="['/wordset', set.word_set_id]"></div>
                <div class="saved-count">{{ set.savedCount }} saved</div>
              </div>

              <div class="right-info">
                <div class="top-row">
                  <div class="card-title-wrapper">
                    <div class="card-title"
                         (click)="openPopup(set.word_set_id!)">
                      {{ set.title }}
                    </div>
                  
                    <!-- Popup sÃ¡t dÆ°á»›i title -->
                    <app-word-set-detail-popup
                      *ngIf="selectedWordSetId != null && selectedWordSetId === set.word_set_id"
                      [word_set_id]="selectedWordSetId!"
                      [showReportButton]="true"
                      (closed)="onPopupClosed()">
                    </app-word-set-detail-popup>
                  </div>
                  
                  
                  <div class="favorite-icon"
                  [ngClass]="{
                      'bi': true,
                      'bi-heart': !isSaved(set.word_set_id!),
                      'bi-heart-fill': isSaved(set.word_set_id!),
                      'filled': isSaved(set.word_set_id!)
                  }"
                  (click)="toggleFavorite(i)">
                </div>
                </div>

                <div class="bottom-row">
                  <div class="card-info left-info">
                    <a class="username"
                          style="cursor: pointer; text-decoration: underline;"
                          [routerLink]="['/wordset-search']"
                          [queryParams]="{ q: set.username }">
                      {{ set.username }}
                    </a>
                    <span class="terms">{{ set.termCount }} terms</span>
                  </div>

                  <div class="dropdown-wrapper" #dropdownWrapper>
                    <button class="play-button" (click)="toggleDropdown(i, $event)">Game On â–¼</button>
                    <div class="dropdown-menu game-dropdown" *ngIf="activeDropdownIndex === i">
                      <button [routerLink]="['/wordsearchgame', set.word_set_id!]">Word Search</button>
                      <button [routerLink]="['/flipcardgame', set.word_set_id!]">Flip Card</button>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>

      <!-- NÃºt See More -->
      <div class="see-more">
        <button *ngIf="visibleCount < filteredVocabSets.length" (click)="showMore()">See more</button>
      </div>

    </div>
  </div>
</div>
